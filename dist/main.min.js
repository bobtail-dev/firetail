!function(t,e){if("function"==typeof define&&define.amd)define("bobtail-deep-cell",["exports","bobtail-rx","bobtail-json-cell","lodash.set"],e);else if("undefined"!=typeof exports)e(exports,require("bobtail-rx"),require("bobtail-json-cell"),require("lodash.set"));else{var r={exports:{}};e(r.exports,t.rx,t.bobtailJsonCell,t.lodashSet),t.bobtailDeepCell=r.exports}}(this,function(t,e,r,n){"use strict";function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0}),t.RWFireTailList=t.RWFireTailCell=t.DepFireTailList=t.DepFireTailCell=void 0;var a=function(t){return t&&t.__esModule?t:{default:t}}(n),f=function(){function t(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var u,l=t[Symbol.iterator]();!(n=(u=l.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),p=function t(e,r,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,r);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},s={child_added:function(t){var e=this;return this._updating(function(){return(0,a.default)(e,["data",t.key],t.val())})},child_changed:function(t){var e=this;return this._updating(function(){return(0,a.default)(e,["data",t.key],t.val())})},child_removed:function(t){var e=this;return this._updating(function(){return delete e.data[t.key]})}},h=function(t){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,n);var o=u(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,r));return o.refFn="function"==typeof t?t:function(){return t},o.refCell=(0,e.bind)(o.refFn),o}return l(n,r.ObsJsonCell),n}(),_=function(t){function e(){return i(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,h),c(e,[{key:"setProperty",value:function(t,r,n,o,i){if(this._nowUpdating)return p(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setProperty",this).call(this,t,r,n,o,i);throw new DepMutationError("Cannot mutate DepJsonCell!")}},{key:"deleteProperty",value:function(t,r,n,o){if(this._nowUpdating)return p(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"deleteProperty",this).call(this,t,r,n,o);throw new DepMutationError("Cannot mutate DepJsonCell!")}}]),e}(),d=(t.DepFireTailCell=function(t){function r(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,r);var o=u(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n));return(0,e.autoSub)(o.refCell.onSet,function(t){var e=f(t,2),r=e[0],n=e[1];r&&r.off(),n.on("value",function(t){return o._update(t.val())})}),o}return l(r,_),r}(),t.DepFireTailList=function(t){function r(t,n){i(this,r);var o=u(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n||{},s));return o._loadPromise=null,(0,e.autoSub)(o.refCell.onSet,function(t){var r=f(t,2),n=r[0],i=r[1];n&&n.off(),o._loadPromise=i.once("value").then(function(t){o._update(t.val());var r=Object.entries(s);(0,e.transaction)(function(){return o._updating(function(){return r.forEach(function(t){var e=f(t,2),r=e[0],n=e[1];return i.on(r,n.bind(o))})})})})}),o}return l(r,_),r}(),function(t){function e(t,r,n){return i(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n))}return l(e,h),c(e,[{key:"setProperty",value:function(t,r,n,i,u){p(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setProperty",this).call(this,t,r,n,i,u);var l=t(i).slice(1).join("/");return this.refCell.raw().update(o({},l,u)),!0}},{key:"deleteProperty",value:function(t,r,n,i){return p(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"deleteProperty",this).call(this,t,r,n,i),this.refCell.raw().update(o({},t(i).slice(1).join("/"),null)),!0}},{key:"data",set:function(t){this._update(t)},get:function(){return this._data.value}}]),e}());t.RWFireTailCell=function(t){function r(t,n){i(this,r);var o=u(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n));return(0,e.autoSub)(o.refCell.onSet,function(t){var e=f(t,2),r=e[0],n=e[1];r&&r.off(),n.on("value",function(t){o._update(t.val())})}),o}return l(r,d),r}(),t.RWFireTailList=function(t){function r(t,n){i(this,r);var o=u(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n||{},s));return o._loadPromise=null,(0,e.autoSub)(o.refCell.onSet,function(t){var e=f(t,2),r=e[0],n=e[1];r&&r.off(),o._loadPromise=n.once("value").then(function(t){o._update(t.val()),Object.entries(s).forEach(function(t){var e=f(t,2),r=e[0],i=e[1];return n.on(r,i.bind(o))})})}),o}return l(r,d),c(r,[{key:"push",value:function(t){var e=this.refCell.raw().push();return e.set(t),e}}]),r}()});