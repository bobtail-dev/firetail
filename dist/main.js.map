{"version":3,"sources":["../src/main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import {autoSub, bind, snap, transaction} from 'bobtail-rx';\nimport {ObsJsonCell, SrcJsonCell} from 'bobtail-json-cell';\nimport safeSet from 'lodash.set';\n\nlet listEvents = {\n  child_added(data){\n    return this._updating(() => safeSet(this, ['data', data.key], data.val()));\n  },\n  child_changed(data){\n    return this._updating(() => safeSet(this, ['data', data.key], data.val()));\n  },\n  child_removed(data){\n    return this._updating(() => delete this.data[data.key]);\n  }\n};\n\nclass FireTailBase extends ObsJsonCell {\n  constructor(refFn, init=null) {\n    super(init);\n    this.refFn = typeof refFn === 'function' ? refFn: () => refFn;\n    this.refCell = bind(this.refFn);\n  }\n}\n\nclass DepFireTailBase extends FireTailBase {\n  constructor() {\n    super(...arguments);\n  }\n  // FIXME: figure out some way to do this via inheritance rather than copy-paste from bobtail-json-cell.\n  setProperty(getPath, basePath, obj, prop, val) {\n    if (!this._nowUpdating) {\n      throw new DepMutationError(\"Cannot mutate DepJsonCell!\");\n    }\n    else return super.setProperty(getPath, basePath, obj, prop, val);\n  }\n\n  deleteProperty(getPath, basePath, obj, prop) {\n    if (!this._nowUpdating) {\n      throw new DepMutationError(\"Cannot mutate DepJsonCell!\");\n    }\n    else return super.deleteProperty(getPath, basePath, obj, prop);\n  }\n}\n\nexport class DepFireTailCell extends DepFireTailBase {\n  constructor(refFn, init=null) {\n    super(refFn, init);\n    autoSub(this.refCell.onSet, ([o, n]) => {\n      if(o) {\n        o.off();  // turn off old listeners, if any\n      }\n      n.on('value', data => this._update(data.val()));\n    });\n  }\n}\n\nexport class DepFireTailList extends DepFireTailBase {\n  constructor(refFn, init) {\n    super(refFn, init || {}, listEvents);\n    this._loadPromise = null;\n    autoSub(this.refCell.onSet, ([o, n]) => {\n      if(o) {\n        o.off();  // turn off old listeners, if any\n      }\n      this._loadPromise = n.once('value').then(data => {\n        this._update(data.val());\n        let entries = Object.entries(listEvents);\n        transaction(() => this._updating(() => entries.forEach(([ev, handler]) => n.on(ev, handler.bind(this)))));\n      });\n    });\n  }\n}\n\nclass RWFireTailBase extends FireTailBase {\n  constructor(refFn, init, events) {\n    super(refFn, init, events);\n  }\n  setProperty (getPath, basePath, obj, prop, val) {\n    super.setProperty(getPath, basePath, obj, prop, val);\n    if(true || !this._nowUpdating) {\n      let path = getPath(prop).slice(1).join('/');\n      this.refCell.raw().update({[path]: val});\n    }\n    return true;\n  }\n  deleteProperty (getPath, basePath, obj, prop) {\n    super.deleteProperty(getPath, basePath, obj, prop);\n    if(true || !this._nowUpdating) {\n      this.refCell.raw().update({[getPath(prop).slice(1).join('/')]: null});\n    }\n    return true;\n  }\n  set data(val) {this._update(val);}\n  get data() {return this._data.value;}\n}\n\nexport class RWFireTailCell extends RWFireTailBase {\n  constructor(refFn, init) {\n    super(refFn, init);\n    autoSub(this.refCell.onSet, ([o, n]) => {\n      if(o) {\n        o.off();  // turn off old listeners, if any\n      }\n      n.on('value', data => {\n        this._update(data.val());\n      });\n    });\n  }\n}\n\nexport class RWFireTailList extends RWFireTailBase {\n  constructor(refFn, init) {\n    super(refFn, init || {}, listEvents);\n    this._loadPromise = null;\n    autoSub(this.refCell.onSet, ([o, n]) => {\n      if(o) {\n        o.off();  // turn off old listeners, if any\n      }\n      this._loadPromise = n.once('value').then(data => {\n        this._update(data.val());\n        let entries = Object.entries(listEvents);\n        entries.forEach(([ev, handler]) => n.on(ev, handler.bind(this)));\n      });\n    });\n  }\n  push(elem) {\n    let ref = this.refCell.raw().push();\n    ref.set(elem);\n    return ref;\n  }\n}"]}